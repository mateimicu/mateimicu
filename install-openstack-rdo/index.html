<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Install Openstack RDO | mateimicu</title><meta property="og:title" content="Install Openstack RDO - mateimicu"><meta property="og:description" content="Install RedHat Deployment of OpenStack using Packstack.
Packstack is a wrapper over a collection of Puppet manifests that install a specific release of OpenStack
Prerequisite&rsquo;s A virtual Machine with CentOS 7 Minimal with the following configurations:
 at least one NAT network at least one Host-Only network 8GB+ RAM 50GB+ disk space enable nested paging enable VT-x/AMD-v  You can follow this article to prepare it.
To enable support for vitalization (nested paging and VT-x/AMD-v) you can go to: Settings -> System -> Acceleration Conventions When you have successfully booted the VM you should have at least two network interfaces:"><meta property="og:url" content="http://mateimicu.com/install-openstack-rdo/"><meta property="og:site_name" content="mateimicu"><meta property="og:type" content="article"><meta property="og:image" content="https://www.gravatar.com/avatar/dd1a4254a9857691eef6ceeed38f6801?s=256"><meta property="article:section" content><meta property="article:published_time" content="2018-04-21T15:32:13+03:00"><meta property="article:modified_time" content="2018-04-21T15:32:13+03:00"><meta name=twitter:card content="summary"><meta name=twitter:site content="@"><meta name=twitter:creator content="@"><link href=http://mateimicu.com/index.xml rel=alternate type=application/rss+xml title=mateimicu><link rel=stylesheet href=/css/style.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav class=nav><div class=nav-left><a class=nav-item href=http://mateimicu.com/><h1 class="title is-4">mateimicu</h1></a></div><div class=nav-right><nav class="nav-item level is-mobile"><a class=level-item aria-label=github href=https://github.com/mateimicu target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></i></span></a><a class=level-item aria-label=email href=mailto:contact@mateimicu.com target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></i></span></a><a class=level-item aria-label=linkedin href=https://linkedin.com/in/matei-marius-micu-0246a211a target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path stroke-width="1.8" d="m5.839218 4.101561c0 1.211972-.974141 2.194011-2.176459 2.194011S1.4863 5.313533 1.4863 4.101561c0-1.211094.974141-2.194011 2.176459-2.194011s2.176459.982917 2.176459 2.194011zm.017552 3.94922h-4.388022v14.04167H5.85677V8.050781zm7.005038.0H8.501869v14.04167h4.360816v-7.370999c0-4.098413 5.291077-4.433657 5.291077.0v7.370999h4.377491v-8.89101c0-6.915523-7.829986-6.66365-9.669445-3.259423V8.050781z"/></svg></i></span></a><a class=level-item aria-label=rss href=/index.xml target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></i></span></a></nav></div></nav><nav class=nav><div class=nav-right><a class=nav-item href=/slides><h2 class="title is-5">Slides</h2></a></div></nav></div></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"></div><h2 class="subtitle is-6">April 21, 2018</h2><h1 class=title>Install Openstack RDO</h1><div class=content><p>Install <a href=1>RedHat Deployment of OpenStack</a> using <a href=2>Packstack</a>.</p><p><strong>Packstack</strong> is a wrapper over a collection of Puppet manifests that install a specific <a href=3>release of OpenStack</a></p><h2 id=prerequisites>Prerequisite&rsquo;s</h2><p>A virtual Machine with <a href=4>CentOS 7 Minimal</a> with the following configurations:</p><ul><li>at least one NAT network</li><li>at least one Host-Only network</li><li>8GB+ RAM</li><li>50GB+ disk space</li><li>enable nested paging</li><li>enable VT-x/AMD-v</li></ul><p>You can follow <a href=5>this</a> article to prepare it.</p><p>To enable support for vitalization (nested paging and VT-x/AMD-v) you can go to:
<strong>Settings -> System -> Acceleration</strong>
<img src=/img/install-openstack-rdo/01-virtualbox-enable-acceleration.png alt="Enable Virtualization Support VirtualBox"></p><h2 id=conventions>Conventions</h2><p>When you have successfully booted the VM you should have at least two network interfaces:</p><ul><li><code>enp0s3</code> corresponding with the NAT network</li><li><code>enp0s8</code> corresponding with the Host-Only network</li></ul><p>We will use the NAT network for internet access to our VM and also internet access for OpenStack networking.
The Host-Only network will be used to connect to the VM.</p><p>Furthermore, I&rsquo;ll assume the following conventions:</p><ul><li><code>enp0s3</code> has the CIDR <code>10.0.2.0/24</code> and the DHCP assigned IP was <code>10.0.2.25</code></li><li><code>enp0s8</code> has the CIRD <code>192.168.99.0/24</code> and the DHCP assigned IP is <code>192.168.99.25</code></li></ul><h2 id=install-packstack-and-prepare-the-system>Install Packstack and prepare the system</h2><p>This process follows the steps form the (RDO website)<a href=https://www.rdoproject.org/install/packstack/>6</a>.</p><h3 id=setup-networking>Setup Networking</h3><p>We need to disable the Network Manager from CentOS and configure a static IP for both interfaces</p><h5 id=disable-network-manager>Disable Network Manager</h5><p>Run the following commands</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ $ sudo systemctl disable firewalld
~ $ sudo systemctl stop firewalld
~ $ sudo systemctl disable NetworkManager
~ $ sudo systemctl stop NetworkManager
~ $ sudo systemctl enable network
~ $ sudo systemctl start network
</code></pre></div><h5 id=setup-static-ip>Setup static IP</h5><p>Because we disabled the Network Manager we can&rsquo;t use (nmcli)<a href=https://developer.gnome.org/NetworkManager/unstable/nmcli.html>7</a> to configure network interfaces.
We will have to rely on the classic network scrips found in <code>/etc/sysconfig/network-scripts/</code></p><p>You can use <code>vi</code> or <code>nano</code> to edit the configurations.</p><p>For the NAT network the configuration (found at <code>/etc/sysconfig/network-scripts/ifcfg-enp0s3</code>) should look like this:</p><pre><code>TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=enp0s3
UUID=&lt;uuid&gt;
DEVICE=enp0s3
ONBOOT=yes

IPADDR=10.0.2.25
NETMASK=255.255.255.0
GATEWAY=10.0.2.2
DNS1=8.8.8.8
DNS2=8.8.4.4
</code></pre><p>For a better understanding I&rsquo;ll explain the required changes:</p><p><code>BOOTPROTO=static</code> this was changed from DHCP, it means we want to set up a static IP not to
ask a DHCP service for one;</p><p><code>ONBOOT=yes</code> this device will be activated at boot time;</p><p><code>IPADDR=10.0.2.25</code> what IP address we want to use. <strong>Notice</strong> this is in the same range
we assumed in the <a href=#conventions>Convention</a> section.</p><p><code>NETMASK=255.255.255.0</code> the netmask for our network. <strong>Notice</strong> this is in the same <code>/24</code>
we assumed in the <a href=#conventions>Convention</a> section.</p><p><code>GATEWAY=10.0.2.2</code> what gateway to use in our network, <code>.2</code> is the default in VirtualBox.</p><p>We configure the <code>DNS</code> to use the ones provided by google.</p><p>More information about the network scripts can be found on the <a href=8>centos website</a>.</p><hr><p>For the Host-Only network the configuration (found at <code>/etc/sysconfig/network-scripts/ifcfg-enp0s8</code>) should look like this:</p><pre><code>TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=enp0s9
UUID=&lt;uuid&gt;
DEVICE=enp0s9
PREFIX=24

ONBOOT=yes
IPADDR=192.168.99.25
NETMASK=255.255.255.0
GATEWAY=192.168.99.2
</code></pre><p>The same parameters as the NAT network were configured. We only omitted the <code>DNS</code>, this network has no Internet Connectivity
and DNS settings are not required.</p><p>To find more about networking in VirtualBox you can read <a href=/posts/create-virtualbox-networks>this</a> article.</p><p>Now you need to apply the configurations to both interfaces:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ $ sudo ifdown enp0s3
~ $ sudo ifdown enp0s8
~ $ sudo ifup enp0s3
~ $ sudo ifup enp0s8
</code></pre></div><p>Now you should be able to connect to the instance</p><h3 id=setup-ssh>Setup SSH</h3><p>You need to install the SSH server</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ $ sudo yum install -y vim openssh-server
~ $ sudo systemctl start sshd
</code></pre></div><p>Now you should be able to connect with ssh to that instance.</p><p>From the Host machine (your laptop) try to connect with ssh to that instance:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ $ ssh root@192.168.99.25
</code></pre></div><p>This ssh connection is more convenient to work.</p><h3 id=install-packstack>Install Packstack</h3><p>Install the <a href=3>OpenStack realizes</a> you want and the packstack utility</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ $ sudo yum install -y centos-release-openstack-pike
~ $ sudo yum update -y
~ $ sudo yum install -y openstack-packstack
</code></pre></div><p>You can use any <a href=3>OpenStack realizes</a>, I tested this with Newton(that is deprecated) and Pike.</p><h3 id=install-openstack>Install Openstack</h3><h4 id=simple-all-in-one-deployment>Simple All In One deployment</h4><p>Now we provision the OpenStack cluster using Packstack on this instance with default services and configurations.</p><pre><code>~ $ packstack --allinone --ntp-servers=pool.ntp.org
</code></pre><h4 id=using-an-answer-file>Using an answer file</h4><p>You can generate an answer file with the following command:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ $ packstack --gen-answer-file<span style=color:#f92672>=</span>~/answers-file.txt
</code></pre></div><p>If we look at this file we can see all the configuration used by the Packstack utility.
Some configuration that might be helpful for a simple deployment might be:</p><pre><code>CONFIG_SWIFT_INSTALL=n
CONFIG_CEILOMETER_INSTALL=n
CONFIG_AODH_INSTALL=n
CONFIG_GNOCCHI_INSTALL=n
CONFIG_HEAT_INSTALL=y
CONFIG_NTP_SERVERS=pool.ntp.org
CONFIG_NAGIOS_INSTALL=n
CONFIG_DEBUG_MODE=y
</code></pre><p>Run the utility with this settings</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ $ packstack --answer-file<span style=color:#f92672>==</span>~/answers-file.txt
</code></pre></div><h3 id=access-horizon>Access Horizon</h3><p>To access the OpenStack deployment you first need to allow access to <code>httpd</code> from the private ip.</p><p>Edit the file <code>/etc/httpd/conf.d/15-horizon_vhost.conf</code> and replace all occurrence&rsquo;s of <code>ServerAlias</code> with just one <code>ServerAlias *</code>.
It should look like this (this is just the snipper)</p><pre><code>...

  ## Server aliases
  ServerAlias *
  WSGIApplicationGroup %{GLOBAL}
  WSGIDaemonProcess apache group=apache processes=3 threads=10 user=apache
...

</code></pre><p>You can now access the dashboard using the private ip (in our example <code>192.168.99.25</code>).
The credential can be found in one of the files <code>keystonerc_admin</code> or <code>keystonerc_admin</code>.</p><h3 id=troubleshooting>Troubleshooting</h3><p>When the packer utility finishes, it will give you information about the status of the deployment and the location of the logs.
It might look something like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ERROR : Error appeared during Puppet run: 10.0.2.30_controller.pp
Error: Execution of <span style=color:#e6db74>&#39;/usr/bin/rpm -e mariadb-server-10.1.20-1.el7.x86_64&#39;</span> returned 1: error: Failed dependencies:
You will find full trace in log /var/tmp/packstack/20180422-164044-c2KzyF/manifests/10.0.2.30_controller.pp.log
</code></pre></div><p>You can usually fix the problem by installing/removing some package that has a problem or change some configuration in your
answer file. After you fixed the problem you can run the <code>packstack</code> command with the <code>--answer-file</code> parameter to install Openstack.</p><p>You can also run <code>packstack</code> in debug mode with the flag <code>--debug</code>.</p><p>You can list all the Openstack services with the following command:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>~ $ systemctl list-units openstack-*
</code></pre></div><div class=related></div></div></div></section><section class=section><div class="container has-text-centered"><p></p></div></section></body></html>